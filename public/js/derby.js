jQuery(document).ready(function(){function t(){y("#startGame").on("click",o),y("#bg_switcher").on("click",l),y("#btn-pitch-js").on("click",e),d=y("#derbyCanvas"),f=d[0].getContext("2d"),h=y("#pitchCanvas"),u=h[0].getContext("2d"),h[0].addEventListener("click",function(t){var e=s(pitchCanvas,t);console.log("Mouse position: "+Math.round(e.x)+","+e.y),g&&e.x>g.x&&e.x<g.x+.8*g.distance&&g&&e.y>g.y&&e.y<g.y+.8*g.distance&&(console.log("ya"),homerunTotal++,u.fillStyle="green",u.fill(),n())},!1),y("#stopRAF").on("click",function(){window.cancelAnimationFrame(b)}),y("#startRAF").on("click",function(){b=window.requestAnimationFrame(k)})}function e(){console.log("initPitch"),g=Math.random()>.5?new v(270,160,r(4,-1),r(6,1),0,"curveball"):new v(c(240,360),c(200,280),1,2,0,"fastball"),a()}function o(){f.beginPath(),f.lineWidth="4",f.strokeStyle="black",f.fillStyle="rgba(255, 255, 255, 1)",f.rect(240,200,40,180),f.rect(280,200,40,180),f.rect(320,200,40,180),f.rect(240,200,120,60),f.rect(240,260,120,60),f.rect(240,320,120,60),f.stroke(),i()}function i(){var t,e,o,i=new Object({hot:[{id:5,alpha:.4},{id:8,alpha:.8},{id:9,alpha:.3}],cold:[{id:1,alpha:.7},{id:2,alpha:.4}]}),n=40,a=60,l=240,r=200;f.fillStyle="rgba(255, 50, 50, 0.7)";for(t in i.hot)t=i.hot[t],console.log(t.id+": "+t.alpha),f.fillStyle="rgba(255, 50, 50, "+t.alpha+")",o=Math.floor((t.id-1)/3),e=(t.id-1)%3,console.log(e+", "+o),f.fillRect(l+e*n,r+o*a,n,a),f.strokeRect(l+e*n,r+o*a,n,a);for(t in i.cold)t=i.cold[t],console.log(t.id+": "+t.alpha),f.fillStyle="rgba(50, 50, 255, "+t.alpha+")",o=Math.floor((t.id-1)/3),e=(t.id-1)%3,console.log(e+", "+o),f.fillRect(l+e*n,r+o*a,n,a),f.strokeRect(l+e*n,r+o*a,n,a)}function n(){switch(homerunTotal){case 1:f.strokeStyle="rgba(50,153,255,0.7)",f.beginPath(),f.moveTo(300,250),f.bezierCurveTo(400,10,475,0,550,130),f.stroke();break;case 2:f.strokeStyle="rgba(50,153,255,0.9)",f.beginPath(),f.moveTo(305,280),f.bezierCurveTo(370,10,440,0,475,75),f.stroke();break;case 3:f.strokeStyle="rgba(50,153,255,0.6)",f.beginPath(),f.moveTo(340,300),f.bezierCurveTo(160,10,120,0,80,80),f.stroke();break;case 4:f.strokeStyle="rgba(50,153,255,0.6)",f.beginPath(),f.moveTo(330,310),f.quadraticCurveTo(160,10,90,95),f.stroke();break;default:f.strokeStyle="rgba(50,153,255,0.6)",f.moveTo(r(340,260),r(380,200)),f.quadraticCurveTo(160,10,r(580,20),r(200,120)),f.stroke()}}function a(){console.log("drawPitch"),console.info("The wind up..."),"curveball"===g.pitchType&&g.distance>10&&(g.dY+=g.dY/12),g.x=g.x+g.dX,g.y=g.y+g.dY,u.clearRect(0,0,600,400),u.fillStyle="rgba(255,255,255,1)",u.strokeStyle="rgba(0,153,255,0.4)",u.save(),u.beginPath(),u.arc(g.x+g.dX,g.y+g.dY,.8*g.distance,0,2*Math.PI,!1),u.fillStyle="white",u.fill(),u.lineWidth=2,u.strokeStyle="#300",u.stroke(),g.distance>23?setTimeout(function(){u.clearRect(0,0,600,400),g.x=g.x+g.dX,g.y=g.y+g.dY,setTimeout(e,200)},1500):(g.distance++,b=window.requestAnimationFrame(k))}function l(t){var e=y(this).find("input:checked");e&&e.length>0&&d.css("background","url( img/bg_stadium-"+e.val()+".jpg)")}function r(t,e){return Math.floor(Math.random()*(t-e))+e}function c(t,e){return Math.floor(Math.random()*(t-e))+e}function s(t,e){var o=t.getBoundingClientRect();return{x:e.clientX-o.left,y:e.clientY-o.top}}var d,h,u,f,g,b,y=jQuery,k=a;homerunTotal=0;var v=function(t,e,o,i,n,a){this.x=t,this.y=e,this.dX=o,this.dY=i,this.distance=n,this.pitchType=a};t()});